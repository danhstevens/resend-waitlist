{"version":3,"sources":["../src/server.ts"],"sourcesContent":["import { Resend } from 'resend';\nimport { Ratelimit } from \"@upstash/ratelimit\";\nimport { Redis } from \"@upstash/redis\";\n\ninterface ResendWaitlistProps {\n  apiKey: string;\n  audienceId: string;\n  upstashUrl?: string;\n  upstashToken?: string;\n  ratePerMinute?: number;\n}\n\nexport class ResendWaitlist {\n  resend: Resend;\n  audienceId: string;\n  rateLimiter?: Ratelimit;\n\n  constructor({ apiKey, audienceId, upstashUrl, upstashToken, ratePerMinute }: ResendWaitlistProps) {\n    // Resend params\n    this.audienceId = audienceId;\n    this.resend = new Resend(apiKey);\n\n    // Rate limit params\n    if (upstashUrl && upstashToken) {\n      this.rateLimiter = new Ratelimit({\n        redis: new Redis({ url: upstashUrl, token: upstashToken }),\n        limiter: Ratelimit.slidingWindow(ratePerMinute || 10, \"60 s\"),\n        prefix: \"@upstash/ratelimit\",\n        analytics: true\n      });\n    }\n  }\n\n  async addToWaitlist(email: string, fullName?: string) {\n    if (this.rateLimiter) {\n      const { success, limit, remaining, pending } = await this.rateLimiter.limit(\"waitlist\");\n      if (!success) {\n        throw new Error(`Woah, slow down there buddy! Rate limit exceeded.`);\n      }\n    }\n\n    const nameParts = fullName?.trim().split(/\\s+/);\n    return await this.resend.contacts.create({\n      email: email.trim().toLowerCase(),\n      firstName: nameParts?.[0],\n      lastName: nameParts?.[1] ? nameParts.slice(1).join(\" \") : undefined,\n      audienceId: this.audienceId\n    });\n  }\n}"],"mappings":";AAAA,SAAS,cAAc;AACvB,SAAS,iBAAiB;AAC1B,SAAS,aAAa;AAUf,IAAM,iBAAN,MAAqB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YAAY,EAAE,QAAQ,YAAY,YAAY,cAAc,cAAc,GAAwB;AAEhG,SAAK,aAAa;AAClB,SAAK,SAAS,IAAI,OAAO,MAAM;AAG/B,QAAI,cAAc,cAAc;AAC9B,WAAK,cAAc,IAAI,UAAU;AAAA,QAC/B,OAAO,IAAI,MAAM,EAAE,KAAK,YAAY,OAAO,aAAa,CAAC;AAAA,QACzD,SAAS,UAAU,cAAc,iBAAiB,IAAI,MAAM;AAAA,QAC5D,QAAQ;AAAA,QACR,WAAW;AAAA,MACb,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,MAAM,cAAc,OAAe,UAAmB;AACpD,QAAI,KAAK,aAAa;AACpB,YAAM,EAAE,SAAS,OAAO,WAAW,QAAQ,IAAI,MAAM,KAAK,YAAY,MAAM,UAAU;AACtF,UAAI,CAAC,SAAS;AACZ,cAAM,IAAI,MAAM,mDAAmD;AAAA,MACrE;AAAA,IACF;AAEA,UAAM,YAAY,UAAU,KAAK,EAAE,MAAM,KAAK;AAC9C,WAAO,MAAM,KAAK,OAAO,SAAS,OAAO;AAAA,MACvC,OAAO,MAAM,KAAK,EAAE,YAAY;AAAA,MAChC,WAAW,YAAY,CAAC;AAAA,MACxB,UAAU,YAAY,CAAC,IAAI,UAAU,MAAM,CAAC,EAAE,KAAK,GAAG,IAAI;AAAA,MAC1D,YAAY,KAAK;AAAA,IACnB,CAAC;AAAA,EACH;AACF;","names":[]}